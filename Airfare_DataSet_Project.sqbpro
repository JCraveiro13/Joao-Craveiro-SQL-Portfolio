<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="C:/Users/joaoc/OneDrive/Desktop/Random/Programming/Data Science/Online-Data-Store/Airfare_Data.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="150"/><column_width id="3" width="3471"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,12:mainairfare_data"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="CovidDeaths" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="101"/><column index="2" value="108"/><column index="3" value="112"/><column index="4" value="111"/><column index="5" value="120"/><column index="6" value="126"/><column index="7" value="123"/><column index="8" value="235"/><column index="9" value="139"/><column index="10" value="136"/><column index="11" value="248"/><column index="12" value="254"/><column index="13" value="251"/><column index="14" value="300"/><column index="15" value="267"/><column index="16" value="264"/><column index="17" value="300"/><column index="18" value="197"/><column index="19" value="137"/><column index="20" value="265"/><column index="21" value="155"/><column index="22" value="283"/><column index="23" value="251"/><column index="24" value="300"/><column index="25" value="269"/><column index="26" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="CovidVaccinations" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="101"/><column index="2" value="108"/><column index="3" value="112"/><column index="4" value="111"/><column index="5" value="119"/><column index="6" value="116"/><column index="7" value="273"/><column index="8" value="270"/><column index="9" value="228"/><column index="10" value="300"/><column index="11" value="145"/><column index="12" value="165"/><column index="13" value="148"/><column index="14" value="197"/><column index="15" value="203"/><column index="16" value="261"/><column index="17" value="157"/><column index="18" value="194"/><column index="19" value="300"/><column index="20" value="300"/><column index="21" value="300"/><column index="22" value="300"/><column index="23" value="300"/><column index="24" value="300"/><column index="25" value="300"/><column index="26" value="300"/><column index="27" value="188"/><column index="28" value="207"/><column index="29" value="137"/><column index="30" value="166"/><column index="31" value="166"/><column index="32" value="173"/><column index="33" value="187"/><column index="34" value="245"/><column index="35" value="223"/><column index="36" value="178"/><column index="37" value="158"/><column index="38" value="246"/><column index="39" value="300"/><column index="40" value="173"/><column index="41" value="296"/><column index="42" value="300"/><column index="43" value="300"/><column index="44" value="184"/><column index="45" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="PercentPopulationVaccinated" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="108"/><column index="2" value="92"/><column index="3" value="120"/><column index="4" value="194"/><column index="5" value="211"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="airfare_data" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort><column index="5" mode="0"/></sort><column_widths><column index="1" value="61"/><column index="2" value="88"/><column index="3" value="166"/><column index="4" value="166"/><column index="5" value="300"/><column index="6" value="350"/><column index="7" value="116"/><column index="8" value="126"/><column index="9" value="68"/><column index="10" value="112"/><column index="11" value="106"/><column index="12" value="85"/><column index="13" value="129"/><column index="14" value="68"/><column index="15" value="102"/><column index="16" value="141"/><column index="17" value="300"/><column index="18" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="airfare_data - airfare_data" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="61"/><column index="2" value="88"/><column index="3" value="166"/><column index="4" value="166"/><column index="5" value="300"/><column index="6" value="300"/><column index="7" value="88"/><column index="8" value="126"/><column index="9" value="68"/><column index="10" value="112"/><column index="11" value="106"/><column index="12" value="85"/><column index="13" value="129"/><column index="14" value="68"/><column index="15" value="102"/><column index="16" value="141"/><column index="17" value="300"/><column index="18" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="albums" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="100"/><column index="2" value="300"/><column index="3" value="90"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="artists" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="90"/><column index="2" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="customers" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="131"/><column index="2" value="115"/><column index="3" value="125"/><column index="4" value="300"/><column index="5" value="300"/><column index="6" value="199"/><column index="7" value="65"/><column index="8" value="149"/><column index="9" value="123"/><column index="10" value="199"/><column index="11" value="189"/><column index="12" value="282"/><column index="13" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="employees" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="133"/><column index="2" value="111"/><column index="3" value="115"/><column index="4" value="187"/><column index="5" value="115"/><column index="6" value="195"/><column index="7" value="195"/><column index="8" value="275"/><column index="9" value="102"/><column index="10" value="65"/><column index="11" value="92"/><column index="12" value="123"/><column index="13" value="178"/><column index="14" value="178"/><column index="15" value="256"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="genres" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="96"/><column index="2" value="172"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="invoice_items" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="153"/><column index="2" value="111"/><column index="3" value="91"/><column index="4" value="105"/><column index="5" value="99"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="invoices" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="111"/><column index="2" value="131"/><column index="3" value="195"/><column index="4" value="300"/><column index="5" value="199"/><column index="6" value="129"/><column index="7" value="156"/><column index="8" value="187"/><column index="9" value="62"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="media_types" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="145"/><column index="2" value="253"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="playlist_track" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="108"/><column index="2" value="91"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="playlists" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="108"/><column index="2" value="237"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="sqlite_sequence" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="129"/><column index="2" value="61"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="tracks" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="91"/><column index="2" value="300"/><column index="3" value="100"/><column index="4" value="145"/><column index="5" value="96"/><column index="6" value="300"/><column index="7" value="135"/><column index="8" value="95"/><column index="9" value="105"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1">---- Data Preparation ----
---- This Data set is in pretty good shape already. I will change the name of the table, in order to make queries easier.

-- ALTER TABLE 'airfare_data - airfare_data' RENAME TO 'airfare_data';

---- Data Exploration ----
---- 1. What range of years are represented in the data?

SELECT MIN(Year) AS 'First Year', MAX(Year) AS 'Most Recent'
FROM airfare_data;

---- The range of years present in this dataset is that of 22 years (1996-2018).

---- 2. What are the shortest and longest-distanced flights, and between which 2 cities are they?

WITH short AS (SELECT city1, city2, MIN(nsmiles) AS 'Short_flight'
FROM airfare_data
), long AS (SELECT city1, city2, MAX(nsmiles) AS 'Long_flight'
FROM airfare_data
)

SELECT short.city1, short.city2, Short_flight
FROM short 
UNION 
SELECT long.city1, long.city2, Long_flight
FROM long;

---- 3. How many distinct cities are represented in the data (regardless of whether it is the source or destination)?

WITH all_cities AS (
SELECT city1 FROM airfare_data
UNION
SELECT city2 FROM airfare_data
)

SELECT COUNT(DISTINCT(city1)) AS 'Total_Cities'
FROM all_cities;

---- This query gave us a total amount of 163 distinct cities.

---- Data Analysis

---- 4.1 Which airline appear most frequently as the carrier with the lowest fare (ie. carrier_low)? 

SELECT carrier_low, COUNT(*)
FROM airfare_data
WHERE carrier_low IS NOT NULL
GROUP BY 1
ORDER BY 2 DESC
LIMIT 5;

---- This Query shows us that the airline &quot;WN&quot; is the one with the lowest fare most of the time.

---- 4.2 How about the airline with the largest market share (ie. carrier_lg)?

SELECT carrier_lg, COUNT(*)
FROM airfare_data
WHERE carrier_lg IS NOT NULL
GROUP BY 1
ORDER BY 2 DESC
LIMIT 5;

---- This query indicates WN to be the airline with the largest market share.

---- 5.1 How many instances are there where the carrier with the largest market share is not the carrier with the lowest fare? 

SELECT COUNT(carrier_lg)
FROM airfare_data
WHERE carrier_lg != carrier_low;

---- There were 59851 times that the carrier with the largest market share wasn't the carrier with the lowest fare. 

---- 5.2 What is the average difference in fare?

SELECT ROUND(AVG(fare-fare_low), 2) AS 'Average Difference in fare'
FROM airfare_data;

---- The average difference in fare was that of 28.71$.

---- Intermediate Challenge ----

---- 6.1 What is the percent change in average fare from 2007 to 2017 by flight? 

WITH initial AS (
SELECT year, AVG(fare) AS 'Average'
FROM airfare_data
WHERE Year = 2007
GROUP BY Year
), latter AS (
SELECT year, AVG(fare) AS 'Average'
FROM airfare_data
WHERE Year = 2017
GROUP BY Year
)

SELECT initial.year, initial.Average, latter.year, latter.Average,
(((latter.Average) - (initial.Average))/(initial.Average)) * 100 AS 'Percent_Change'
FROM initial, latter;

---- There was a 19.23% change in fare prices between 2007 and 2017

---- 6.2 How about from 1997 to 2017?

WITH initial AS (
SELECT year, AVG(fare) AS 'Average'
FROM airfare_data
WHERE Year = 1997
GROUP BY Year
), latter AS (
SELECT year, AVG(fare) AS 'Average'
FROM airfare_data
WHERE Year = 2007
GROUP BY Year
)

SELECT initial.year, initial.Average, latter.year, latter.Average,
(((latter.Average) - (initial.Average))/(initial.Average)) * 100 AS 'Percent_Change'
FROM initial, latter;

---- There was a 3.61% change in fare prices between 1997 and 2007

---- 7. How would you describe the overall trend in airfares from 1997 to 2017, as compared 2007 to 2017?

-- When comparing the percentage change in fares between the two decades we can observe a significantly higher increase in fare prices in the second one.

---- What is the average fare for each quarter? Which quarter of the year has the highest overall average fare? lowest?

WITH Q1 AS (
SELECT year, quarter, AVG(fare) AS 'Q1_Average_Fare'
FROM airfare_data
WHERE quarter = 1 
GROUP BY 1
), Q2 AS(
SELECT year, quarter, AVG(fare) AS 'Q2_Average_Fare'
FROM airfare_data
WHERE quarter = 2 
GROUP BY 1
), Q3 AS (
SELECT year, quarter, AVG(fare) AS 'Q3_Average_Fare'
FROM airfare_data
WHERE quarter = 3 
GROUP BY 1
), Q4 AS (
SELECT year, quarter, AVG(fare) AS 'Q4_Average_Fare'
FROM airfare_data
WHERE quarter = 4 
GROUP BY 1
)

SELECT Q1.quarter, ROUND(AVG(Q1.Q1_Average_Fare), 2)  AS 'Q1 AVERAGE', Q2.quarter, ROUND(AVG(Q2.Q2_Average_Fare), 2) AS 'Q2 AVERAGE', 
Q3.quarter, ROUND(AVG(Q3.Q3_Average_Fare), 2) AS 'Q3 AVERAGE', Q4.quarter, ROUND(AVG(Q4.Q4_Average_Fare), 2) AS 'Q4 AVERAGE'
FROM Q1 JOIN Q2
ON Q1.Year = Q2.Year
JOIN Q3 
ON Q3.Year = Q2.Year
JOIN Q4
ON Q4.Year = Q3.Year;

---- The highest average fare can be found in the first quarter of the year and the lowest in the last one. This is, of course, an average.</sql><current_tab id="0"/></tab_sql></sqlb_project>
