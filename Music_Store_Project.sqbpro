<?xml version="1.0" encoding="UTF-8"?><sqlb_project><db path="C:/Users/joaoc/OneDrive/Desktop/Random/Programming/Data Science/Online-Data-Store/chinook.db" readonly="0" foreign_keys="1" case_sensitive_like="0" temp_store="0" wal_autocheckpoint="1000" synchronous="2"/><attached/><window><main_tabs open="structure browser pragmas query" current="3"/></window><tab_structure><column_width id="0" width="300"/><column_width id="1" width="0"/><column_width id="2" width="150"/><column_width id="3" width="6053"/><column_width id="4" width="0"/><expanded_item id="0" parent="1"/><expanded_item id="1" parent="1"/><expanded_item id="2" parent="1"/><expanded_item id="3" parent="1"/></tab_structure><tab_browse><current_table name="4,6:mainalbums"/><default_encoding codec=""/><browse_table_settings><table schema="main" name="CovidDeaths" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="101"/><column index="2" value="108"/><column index="3" value="112"/><column index="4" value="111"/><column index="5" value="120"/><column index="6" value="126"/><column index="7" value="123"/><column index="8" value="235"/><column index="9" value="139"/><column index="10" value="136"/><column index="11" value="248"/><column index="12" value="254"/><column index="13" value="251"/><column index="14" value="300"/><column index="15" value="267"/><column index="16" value="264"/><column index="17" value="300"/><column index="18" value="197"/><column index="19" value="137"/><column index="20" value="265"/><column index="21" value="155"/><column index="22" value="283"/><column index="23" value="251"/><column index="24" value="300"/><column index="25" value="269"/><column index="26" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="CovidVaccinations" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="101"/><column index="2" value="108"/><column index="3" value="112"/><column index="4" value="111"/><column index="5" value="119"/><column index="6" value="116"/><column index="7" value="273"/><column index="8" value="270"/><column index="9" value="228"/><column index="10" value="300"/><column index="11" value="145"/><column index="12" value="165"/><column index="13" value="148"/><column index="14" value="197"/><column index="15" value="203"/><column index="16" value="261"/><column index="17" value="157"/><column index="18" value="194"/><column index="19" value="300"/><column index="20" value="300"/><column index="21" value="300"/><column index="22" value="300"/><column index="23" value="300"/><column index="24" value="300"/><column index="25" value="300"/><column index="26" value="300"/><column index="27" value="188"/><column index="28" value="207"/><column index="29" value="137"/><column index="30" value="166"/><column index="31" value="166"/><column index="32" value="173"/><column index="33" value="187"/><column index="34" value="245"/><column index="35" value="223"/><column index="36" value="178"/><column index="37" value="158"/><column index="38" value="246"/><column index="39" value="300"/><column index="40" value="173"/><column index="41" value="296"/><column index="42" value="300"/><column index="43" value="300"/><column index="44" value="184"/><column index="45" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="PercentPopulationVaccinated" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="108"/><column index="2" value="92"/><column index="3" value="120"/><column index="4" value="194"/><column index="5" value="211"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="albums" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="100"/><column index="2" value="300"/><column index="3" value="90"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="artists" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="90"/><column index="2" value="300"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="customers" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="131"/><column index="2" value="115"/><column index="3" value="125"/><column index="4" value="300"/><column index="5" value="300"/><column index="6" value="199"/><column index="7" value="65"/><column index="8" value="149"/><column index="9" value="123"/><column index="10" value="199"/><column index="11" value="189"/><column index="12" value="282"/><column index="13" value="156"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="employees" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="133"/><column index="2" value="111"/><column index="3" value="115"/><column index="4" value="187"/><column index="5" value="115"/><column index="6" value="195"/><column index="7" value="195"/><column index="8" value="275"/><column index="9" value="102"/><column index="10" value="65"/><column index="11" value="92"/><column index="12" value="123"/><column index="13" value="178"/><column index="14" value="178"/><column index="15" value="256"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="genres" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="96"/><column index="2" value="172"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="invoice_items" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="153"/><column index="2" value="111"/><column index="3" value="91"/><column index="4" value="105"/><column index="5" value="99"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="invoices" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="111"/><column index="2" value="131"/><column index="3" value="195"/><column index="4" value="300"/><column index="5" value="199"/><column index="6" value="129"/><column index="7" value="156"/><column index="8" value="187"/><column index="9" value="62"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="media_types" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="145"/><column index="2" value="253"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="playlist_track" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="108"/><column index="2" value="91"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="playlists" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="108"/><column index="2" value="237"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="sqlite_sequence" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="129"/><column index="2" value="61"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table><table schema="main" name="tracks" show_row_id="0" encoding="" plot_x_axis="" unlock_view_pk="_rowid_"><sort/><column_widths><column index="1" value="91"/><column index="2" value="300"/><column index="3" value="100"/><column index="4" value="145"/><column index="5" value="96"/><column index="6" value="300"/><column index="7" value="135"/><column index="8" value="95"/><column index="9" value="105"/></column_widths><filter_values/><conditional_formats/><row_id_formats/><display_formats/><hidden_columns/><plot_y_axes/><global_filter/></table></browse_table_settings></tab_browse><tab_sql><sql name="SQL 1">-------- Which tracks appeared in the most playlists? How many playlist did they appear in? ---------

WITH track_playlist AS (
SELECT *
FROM tracks
LEFT JOIN playlist_track
ON tracks.TrackId = playlist_track.TrackId
),	max_track AS (
SELECT COUNT(name) AS numbers
FROM track_playlist
GROUP BY name
)

SELECT name, MAX(numbers)
FROM max_track, track_playlist;


SELECT tracks.name, COUNT(playlist_track.PlaylistId) AS numbers
FROM tracks JOIN playlist_track
ON tracks.TrackId = playlist_track.TrackId
GROUP BY playlist_track.TrackId
ORDER BY 2 DESC
LIMIT 10;


-------- Which track generated the most revenue? --------

SELECT tracks.TrackId, tracks.Name, SUM(TOTAL) AS 'Revenue'
FROM tracks JOIN invoice_items
ON tracks.TrackId = invoice_items.TrackId
JOIN invoices 
ON invoices.InvoiceId = invoice_items.InvoiceId
GROUP BY 1
ORDER BY 3 DESC 
LIMIT 10;


-------- Which album? -------

SELECT albums.AlbumId, albums.Title, SUM(invoices.Total) AS 'Album Revenues'
FROM albums JOIN tracks
ON albums.AlbumId = tracks.TrackId
JOIN invoice_items
ON invoice_items.TrackId = tracks.TrackId
JOIN invoices
ON invoices.InvoiceId = invoice_items.InvoiceId
GROUP BY 1
ORDER BY 3
LIMIT 10;

-------- Which genre? -------

SELECT genres.GenreId, genres.name, SUM(invoices.Total) AS 'Genre Revenues'
FROM genres JOIN tracks
ON genres.GenreId = tracks.GenreId
JOIN invoice_items
ON invoice_items.TrackId = tracks.TrackId
JOIN invoices
ON invoices.InvoiceId = invoice_items.InvoiceId
GROUP BY 1
ORDER BY 3 DESC
LIMIT 10;

------ What is the total revenue generated by which country? What percent of total revenue is it? -------

WITH sum_total AS(
SELECT SUM(TOTAL) AS total_sum FROM invoices
)

SELECT BillingCountry, SUM(Total) AS country_revenue, ROUND(SUM(TOTAL)/sum_total.total_sum, 2) * 100.0 AS country_revenue_share 
FROM invoices, sum_total
GROUP BY BillingCountry
ORDER BY SUM(Total) DESC 
LIMIT 10;


------ How many customers did each employee support? -----

WITH employee_customer AS(SELECT customers.CustomerId AS customer, customers.SupportRepId AS employee_customer, employees.EmployeeId AS employee, employees.LastName
FROM customers
LEFT JOIN employees
ON customers.SupportRepId = employees.EmployeeId
)

SELECT LastName, COUNT(employee_customer.employee) AS total_work
FROM employee_customer
GROUP BY employee_customer.employee
ORDER BY employee; 

----What is the average revenue for each sale? This Question was badly formatted. I assume it's asking the average revenue for each sale, per employee. ------ 

WITH sales_reps AS (
SELECT invoices.Total, invoices.CustomerId, customers.CustomerId, customers.SupportRepId, employees.EmployeeId, employees.LastName
FROM customers JOIN invoices
ON customers.CustomerId = invoices.CustomerId
JOIN employees
ON customers.SupportRepId = employees.EmployeeId
)

SELECT LastName, ROUND(AVG(Total), 2) AS Average_Sale_Revenue, ROUND(SUM(Total), 2) AS Total_Revenue
FROM sales_reps
GROUP BY EmployeeId
ORDER BY 2 DESC;


---- What is their total sale? Answered in the Query above, for simplicity sake.----

---- Do longer or shorter length albums tend to generate more revenue? ----

WITH album_length AS(
	SELECT albums.AlbumId, albums.Title, SUM(tracks.Milliseconds)/1000/60 AS 'length_in_minutes',
	CASE
	WHEN SUM(Milliseconds)/1000/60 &gt; 60 
		THEN 'Long'
	ELSE 'Short'
	END 'Album_Classification'
	FROM albums JOIN tracks
	ON albums.AlbumId = tracks.AlbumId
	GROUP BY 1
	ORDER BY 3 DESC
)

SELECT album_length.Title, length_in_minutes, album_classification, SUM(Total) AS 'Album Revenue'
FROM tracks JOIN album_length
ON tracks.AlbumId = album_length.AlbumId
JOIN invoice_items
ON invoice_items.TrackId = tracks.TrackId
JOIN invoices
ON invoices.InvoiceId = invoice_items.InvoiceId
GROUP BY 1
ORDER BY 4 DESC
LIMIT 10;

---- Is the number of times a track appear in any playlist a good indicator of sales? ----

WITH track_in_playlists AS(
	SELECT tracks.TrackId, tracks.Name, COUNT(playlist_track.TrackId) AS track_playlists
	FROM tracks JOIN playlist_track
	ON tracks.TrackId = playlist_track.TrackId
	GROUP BY 1
	ORDER BY 3 DESC
)

SELECT track_in_playlists.track_playlists AS 'Number of Playlists' , ROUND(AVG(Total), 2) AS 'Average Revenue'
FROM track_in_playlists JOIN invoice_items
ON track_in_playlists.TrackId = invoice_items.TrackId
JOIN invoices
ON invoices.InvoiceId = invoice_items.InvoiceId
GROUP BY 1
ORDER BY 2 DESC;</sql><current_tab id="0"/></tab_sql></sqlb_project>
